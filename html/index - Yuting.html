	<!DOCTYPE html>
	<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

		<title>Project</title>

		<!--Import Google Icon Font-->
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">


		<script
		src="https://code.jquery.com/jquery-3.3.1.min.js"
		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		crossorigin="anonymous"></script>
		<style>
		  /* Always set the map height explicitly to define the size of the div
		  * element that contains the map. */
		  html, body, #map {
			width: 100%;
			height: 100%;
			margin: 0;
			padding: 0;
		  }
		  .layer, .layer svg {position: absolute;}

		  .layer svg {
			width: 60px;
			height: 60px;
			padding-right: 100px;
			font: 10px sans-serif;
		  }
		  div.tooltip {	
    		position: absolute;			
    		text-align: center;			
    		width: 60px;					
    		height: 28px;					
    		padding: 2px;				
    		font: 12px sans-serif;		
    		background: lightsteelblue;	
    		border: 0px;		
    		border-radius: 8px;			
    		pointer-events: none;			
			}


		</style>
	</head>

	<body>

		<div class="btn-group btn-group-toggle" data-toggle="buttons">
			<label class="btn btn-secondary active">
				<input type="radio" name="options" id="option1" autocomplete="off" checked> $50
			</label>
			<label class="btn btn-secondary">
				<input type="radio" name="options" id="option2" autocomplete="off"> $100
			</label>
			<label class="btn btn-secondary">
				<input type="radio" name="options" id="option3" autocomplete="off"> $200
			</label>
		</div>
		<div id="map" style="width:800px;height:600px"></div>
		<script type="text/javascript">
			
			/*global $*/
			/*global d3*/
			/*global google*/
			var map;
			var bound;
			var heatmapData = []
			var heatmap;
			function eqfeed_callback() {
		// d3.csv("https://firebasestorage.googleapis.com/v0/b/cse6242-1522962742858.appspot.com/o/crime_demo_100.csv?alt=media&token=c0a77a38-89ee-40e5-b222-0e6fd5e4b309",function(dataset){
			d3.csv("https://firebasestorage.googleapis.com/v0/b/cse6242-1522962742858.appspot.com/o/crime_demo_10_000.csv?alt=media&token=3425db39-acb4-412c-8319-8504344c0173"
				,function(dataset){

					heatmapData = [];
			// console.log(dataset)
			
			for (var i = 0; i < dataset.length; i++) {
				var lat =  +parseFloat(dataset[i]["Latitude"]);
				var long =  +parseFloat(dataset[i]["Longitude"]);
				var latLng = new google.maps.LatLng(lat, long);
				heatmapData.push(latLng);
			}
			heatmap = new google.maps.visualization.HeatmapLayer({
				data: heatmapData,
				map: map
			});
			
		})
		}
		function shuffle(array) {
		  var currentIndex = array.length, temporaryValue, randomIndex;

		  // While there remain elements to shuffle...
		  while (0 !== currentIndex) {

			// Pick a remaining element...
			randomIndex = Math.floor(Math.random() * currentIndex);
			currentIndex -= 1;

			// And swap it with the current element.
			temporaryValue = array[currentIndex];
			array[currentIndex] = array[randomIndex];
			array[randomIndex] = temporaryValue;
		  }

		  return array;
		}	
		$( document ).ready(function() {
			console.log( "ready!" );


			// d3.csv("https://firebasestorage.googleapis.com/v0/b/cse6242-1522962742858.appspot.com/o/airbnb_demo.csv?alt=media&token=0f31451e-844e-4c76-88b7-adc0d90a8532", function(dataset) {
			d3.csv("https://firebasestorage.googleapis.com/v0/b/cse6242-1522962742858.appspot.com/o/airbnb_demo_5k.csv?alt=media&token=402360f2-a868-46dc-9c17-f429b19b92f3", function(dataset) {

				var margin = {top: 20, right: 10, bottom: 20, left: 10};
				var width = 800 - margin.left - margin.right;
				var height = 600 - margin.top - margin.bottom;

				bound = new google.maps.LatLngBounds();
				dataset = shuffle(dataset);

				for(var data in dataset){
					dataset[data].latitude =  +parseFloat(dataset[data].latitude);
					dataset[data].longitude =  +parseFloat(dataset[data].longitude);

					var long = +dataset[data].longitude;
					var lat = +dataset[data].latitude;
						// console.log(long + " " + lat);
						bound.extend(new google.maps.LatLng(lat,long));
						
					}

					// var priceScale = d3.scale.linear()
					// 					 .domain([0,d3.max(dataset, function(d) { return d.price; })])
					// 					 .range([0, 5]); 
					
					d3.selectAll('#map').attr('width',width - 200);
					
					map = new google.maps.Map(d3.select("#map").node(),{
						zoom: 1,
						center: new google.maps.LatLng(dataset[0].latitude, dataset[0].longitude),
						mapTypeId: "roadmap"
					});
					
					map.fitBounds(bound);
					
					// Create a <script> tag and set the USGS URL as the source.
					var script = document.createElement('script');

					// This example uses a local copy of the GeoJSON stored at
					// http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
					// script.src = 'https://developers.google.com/maps/documentation/javascript/examples/json/earthquake_GeoJSONP.js';
					// document.getElementsByTagName('head')[0].appendChild(script);
					eqfeed_callback()

					var overlay = new google.maps.OverlayView();
					overlay.onAdd = function(){
						var layer = d3.select(this.getPanes().overlayMouseTarget).append("div")
						.attr("class","layer");

						overlay.draw = function(){
							var projection = this.getProjection();
							var padding = 10;

							var no_of_drawings = parseInt((map.getZoom()/5)**5);
							// console.log(no_of_drawings);
							var data_to_draw = dataset.slice(0, no_of_drawings);

							//define the div for the tooltip 
							var div = d3.select("body").append("div")	
   							.attr("class", "tooltip")				
    						.style("opacity", 0);

							layer.selectAll("svg").remove()
							var marker = layer.selectAll("svg")
							.data(data_to_draw)
								.each(transform) //update existing markers
							.enter().append("svg")
							.on("mouseover", function(d) {		
            						div.transition()		
               						 .duration(200)		
               						 .style("opacity", .9);		
          							div	.html(d.id + "<br/>"  + d.name)	
               						 .style("left", (d3.event.pageX) + "px")		
               						 .style("top", (d3.event.pageY - 28) + "px");	
            							})					
        					.on("mouseout", function(d) {		
           							div.transition()		
                					  .duration(500)		
                					  .style("opacity", 0);	
        })
								.each(transform)
								.attr("class","marker")

							function transform(d){
								d = new google.maps.LatLng(+d.latitude,+d.longitude);
								d = projection.fromLatLngToDivPixel(d);
								return d3.select(this)
								.style("left",(d.x - padding) + "px")
								.style("top",(d.y - padding) + "px" );
							}
							
							// console.log(map.getZoom());

							marker.append("circle")
							.attr("r",5)
							.attr("cx",padding)
							.attr("cy",padding)
							.style("fill","gray");

							marker.append("text")
							.attr("x", padding + 7)
							.attr("y", padding)
							.attr("dy", ".31em")
							.style("fill","blue")
							.style("stroke","blue")
							.text(function(d) { return d.price; });


						};

					}
					overlay.setMap(map);

				});


		});
	</script>


	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDvdyxZpXuv02KqZIdErEBon5C7_Z8F2g&libraries=visualization"
	async defer></script>

</body>
</html>